<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>YÃ¶netim Paneli</title>
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ADMIN PANELÄ°NE Ã–ZEL STÄ°LLER */
        .admin-header { 
            background: linear-gradient(135deg, #1e293b, #0f172a); 
            color: white; padding: 30px; border-radius: 24px; 
            margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); 
            position: relative; overflow: hidden;
        }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        
        .stat-card { 
            background: white; padding: 25px; border-radius: 20px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); 
            text-align: center; border: 1px solid #f1f5f9; transition: 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .stat-number { font-size: 2.5rem; font-weight: 800; color: var(--primary); }

        .charts-container { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 40px; }
        .chart-box { background: white; padding: 25px; border-radius: 20px; box-shadow: var(--shadow-soft); border: 1px solid #f1f5f9; }

        .section-title { 
            font-size: 1.5rem; font-weight: 800; color: var(--dark); 
            margin: 40px 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0; 
            display: flex; align-items: center; gap: 10px;
        }

        table { width: 100%; border-collapse: separate; border-spacing: 0; background: white; border-radius: 16px; overflow: hidden; box-shadow: var(--shadow-soft); margin-bottom: 20px; }
        th, td { padding: 18px 20px; text-align: left; border-bottom: 1px solid #f1f5f9; }
        th { background: #f8fafc; font-weight: 700; color: #475569; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px; }
        tr:hover td { background-color: #f8fafc; }

        .btn-action { padding: 6px 12px; border-radius: 8px; font-size: 0.85rem; font-weight: 600; text-decoration: none; border: none; cursor: pointer; transition: 0.2s; display: inline-block; }
        .btn-edit { background: #fef3c7; color: #92400e; margin-right: 5px; }
        .btn-edit:hover { background: #fde68a; }
        .btn-delete { background: #fee2e2; color: #991b1b; }
        .btn-delete:hover { background: #fecaca; }

        .role-badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; }
        .role-ISVEREN { background: #e0f2fe; color: #0369a1; }
        .role-IS_ARAYAN { background: #dcfce7; color: #15803d; }
        .role-ADMIN { background: #f3e8ff; color: #7e22ce; }

        @media (max-width: 900px) { .charts-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <nav class="navbar">
        <a href="/admin" class="brand">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
            YÃ¶netim Paneli
        </a>
        <ul class="nav-links">
            <li><a href="/" style="color: #64748b; font-size: 0.9rem;">Ä°lanlar</a></li>
            <li><span style="color:var(--primary); font-weight:800; border-bottom: 2px solid var(--primary);">YÃ¶netim Paneli</span></li>
            <li><a href="/cikis" style="color:#ef4444; font-weight: 600;">Ã‡Ä±kÄ±ÅŸ Yap</a></li>
        </ul>
    </nav>

    <div class="container" style="padding-top: 40px;">
        
        <div class="admin-header">
            <div>
                <h1 style="margin:0; font-size: 2rem;">HoÅŸ Geldin, Patron ğŸ˜</h1>
                <p style="margin:5px 0 0 0; opacity:0.8;">Ä°ÅŸ KapÄ±sÄ± platformunun kontrol merkezi.</p>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 2.5rem; font-weight: 800;" th:text="${#temporals.format(#temporals.createNow(), 'dd')}">01</div>
                <div style="text-transform: uppercase; font-size: 0.9rem; letter-spacing: 2px;" th:text="${#temporals.format(#temporals.createNow(), 'MMMM yyyy')}">OCAK 2026</div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" th:text="${tumKullanicilar.size()}">0</div>
                <div style="color: #64748b; font-weight: 600; text-transform: uppercase; font-size: 0.8rem; margin-top: 5px;">Toplam KullanÄ±cÄ±</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${tumIlanlar.size()}">0</div>
                <div style="color: #64748b; font-weight: 600; text-transform: uppercase; font-size: 0.8rem; margin-top: 5px;">Aktif Ä°lan</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #10b981;">%100</div>
                <div style="color: #64748b; font-weight: 600; text-transform: uppercase; font-size: 0.8rem; margin-top: 5px;">Sistem SaÄŸlÄ±ÄŸÄ±</div>
            </div>
        </div>

        <div class="charts-container">
            <div class="chart-box">
                <h3 style="margin-top:0; color:var(--dark); margin-bottom: 20px;">ğŸ‘¥ KullanÄ±cÄ± DaÄŸÄ±lÄ±mÄ±</h3>
                <canvas id="userChart" th:data-isveren="${isverenSayisi}" th:data-isarayan="${isArayanSayisi}"></canvas>
            </div>
            <div class="chart-box">
                <h3 style="margin-top:0; color:var(--dark); margin-bottom: 20px;">ğŸ™ï¸ Åehirlere GÃ¶re Ä°lanlar</h3>
                <canvas id="cityChart" th:data-labels="${sehirIsimleri}" th:data-counts="${sehirSayilari}"></canvas>
            </div>
        </div>

        <h2 class="section-title">ğŸ“¦ Vitrin Paketleri</h2>
        
        <form action="/admin/paket-olustur" method="post" style="background: white; padding: 25px; border-radius: 20px; display: flex; gap: 15px; align-items: flex-end; margin-bottom: 30px; border: 1px solid #e2e8f0; flex-wrap: wrap; box-shadow: var(--shadow-soft);">
            <div style="flex: 2; min-width: 200px;">
                <label style="font-size: 0.85rem; font-weight: 700; color: #64748b; display: block; margin-bottom: 8px;">PAKET ADI</label>
                <input type="text" name="ad" placeholder="Ã–rn: 3 GÃ¼nlÃ¼k SÃ¼per FÄ±rsat" class="search-input" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px;" required>
            </div>
            <div style="flex: 1; min-width: 120px;">
                <label style="font-size: 0.85rem; font-weight: 700; color: #64748b; display: block; margin-bottom: 8px;">SÃœRE (GÃœN)</label>
                <input type="number" name="gun" placeholder="3" class="search-input" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px;" required>
            </div>
            <div style="flex: 1; min-width: 120px;">
                <label style="font-size: 0.85rem; font-weight: 700; color: #64748b; display: block; margin-bottom: 8px;">FÄ°YAT (TL)</label>
                <input type="number" name="fiyat" placeholder="50" class="search-input" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px;" required>
            </div>
            <button type="submit" class="btn btn-primary" style="height: 48px; padding: 0 30px;">âœ… Ekle</button>
        </form>

        <table style="margin-bottom: 40px;">
            <thead>
                <tr>
                    <th>Paket AdÄ±</th>
                    <th>SÃ¼re</th>
                    <th>Fiyat</th>
                    <th style="width: 150px;">Ä°ÅŸlemler</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="p : ${paketler}">
                    <td th:text="${p.ad}" style="font-weight: 600;">Paket AdÄ±</td>
                    <td><span style="background: #f1f5f9; padding: 5px 10px; border-radius: 6px;" th:text="${p.gun + ' GÃ¼n'}"></span></td>
                    <td style="color: #16a34a; font-weight: bold;" th:text="${p.fiyat + ' â‚º'}">50.0</td>
                    <td>
                        <a th:href="@{/admin/paket-duzenle/{id}(id=${p.id})}" class="btn-action btn-edit">âœï¸</a>
                        <a th:href="@{/admin/paket-sil/{id}(id=${p.id})}" onclick="return confirm('Silmek istediÄŸine emin misin?')" class="btn-action btn-delete">ğŸ—‘ï¸</a>
                    </td>
                </tr>
                <tr th:if="${paketler.empty}"><td colspan="4" style="text-align:center; color:#94a3b8; padding: 20px;">Paket yok.</td></tr>
            </tbody>
        </table>

        <h2 class="section-title">ğŸ‘¥ KullanÄ±cÄ± Listesi</h2>
        <div style="display:flex; gap:10px; margin-bottom: 20px;">
            <input type="text" id="kullaniciAra" placeholder="KullanÄ±cÄ± ara..." style="padding: 10px; border: 2px solid #e2e8f0; border-radius: 10px; width: 100%;">
            <select id="rolFiltre" style="padding: 10px; border: 2px solid #e2e8f0; border-radius: 10px;">
                <option value="">TÃ¼m Roller</option>
                <option value="ISVEREN">Ä°ÅŸveren</option>
                <option value="IS_ARAYAN">Ä°ÅŸ Arayan</option>
                <option value="ADMIN">Admin</option>
            </select>
        </div>

        <table id="kullaniciTablosu">
            <thead>
                <tr>
                    <th style="width: 50px;">ID</th>
                    <th>E-Posta</th>
                    <th>Rol</th>
                    <th style="width: 100px;">Ä°ÅŸlem</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="user : ${tumKullanicilar}">
                    <td th:text="${user.id}" style="color: #94a3b8;">1</td>
                    <td th:text="${user.email}" style="font-weight: 500;">email@test.com</td>
                    <td><span th:class="'role-badge role-' + ${user.rol}" th:text="${user.rol}">ROL</span></td>
                    <td>
                        <button th:if="${user.rol.name() != 'ADMIN'}" th:onclick="'kullaniciSil(' + ${user.id} + ')'" class="btn-action btn-delete">Banla</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <h2 class="section-title">ğŸ“„ YayÄ±ndaki Ä°lanlar</h2>
        <input type="text" id="ilanAra" placeholder="Ä°lan ara..." style="padding: 10px; border: 2px solid #e2e8f0; border-radius: 10px; width: 100%; margin-bottom: 20px;">

        <table id="ilanTablosu">
            <thead>
                <tr>
                    <th>BaÅŸlÄ±k</th>
                    <th>Åirket</th>
                    <th>Åehir</th>
                    <th style="width: 100px;">Ä°ÅŸlem</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="ilan : ${tumIlanlar}">
                    <td th:text="${ilan.baslik}" style="font-weight: 600;">BaÅŸlÄ±k</td>
                    <td th:text="${ilan.isveren.sirketAdi}" style="color: #64748b;">Åirket</td>
                    <td th:text="${ilan.sehir}">Åehir</td>
                    <td>
                        <button th:onclick="'ilanSil(' + ${ilan.id} + ')'" class="btn-action btn-delete">KaldÄ±r</button>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <div style="height: 50px;"></div>
    </div>

    <script th:src="@{/js/main.js}"></script>
</body>
</html>